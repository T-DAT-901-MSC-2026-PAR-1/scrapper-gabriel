FROM ghcr.io/astral-sh/uv:debian

WORKDIR /app

# Install system dependencies for Jupyter
RUN apt-get update && apt-get install -y --no-install-recommends \
    tini \
    && rm -rf /var/lib/apt/lists/*

# Copy only project dependencies first
COPY pyproject.toml uv.lock ./

# Create virtual environment and install dependencies
RUN uv sync --frozen

# Now copy the rest of the application
COPY . .

# Make entrypoint script executable
RUN chmod +x /app/docker/entrypoint.dev.sh

# Use tini to handle signals properly
ENTRYPOINT ["/usr/bin/tini", "--", "/bin/bash", "/app/docker/entrypoint.dev.sh"]
